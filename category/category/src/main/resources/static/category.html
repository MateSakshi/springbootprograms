<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Category Data</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background-color: #f2f2f2;
          padding: 20px;
          text-align: center;
        }

        h1 {
          color: #4B0082; /* Purple */
          margin-bottom: 30px;
        }

        .filter-bar {
          display: flex;
          justify-content: center;
          align-items: center;
          flex-wrap: wrap;
          gap: 10px;
          margin-bottom: 25px;
        }

        select, input {
          padding: 8px;
          border-radius: 5px;
          border: 1px solid #ccc;
          width: 200px;
          text-align: center;
          font-size: 14px;
        }

        select:invalid {
          color: gray;
        }

        table {
          width: 65%;
          margin: 0 auto;
          border-collapse: collapse;
          background-color: white;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        th, td {
          border: 1px solid #ddd;
          padding: 10px;
          text-align: center;
        }

        th {
          background-color: #800080; /* Purple header */
          color: white;
        }

        tr:hover {
          background-color: #f3e6ff; /* Light purple hover effect */
        }
    </style>
</head>
<body>
<h1>MySQL Category Data Viewer</h1>

<!-- Filter Bar -->
<div class="filter-bar">
    <!-- Dropdown for Category -->
    <select id="categorySelect" required>
        <option value="all" selected>All Categories</option>
        <option value="Bank">Bank</option>
        <option value="Pharma">Pharma</option>
        <option value="Retail">Retail</option>
        <option value="Agriculture">Agriculture</option>
    </select>

    <!-- Input for ID, Name or Year -->
    <input type="text" id="searchInput" placeholder="Enter ID, Name or Year">
</div>

<!-- Data Table -->
<table id="categoryTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Category Name</th>
        <th>Date of Birth</th>
    </tr>
    </thead>
    <tbody>
    <!-- Data will be inserted here -->
    </tbody>
</table>

<script>
    const baseUrl = "http://localhost:8080/category";
    const categorySelect = document.getElementById("categorySelect");
    const searchInput = document.getElementById("searchInput");

    function renderTable(data) {
      const tableBody = document.querySelector("#categoryTable tbody");
      tableBody.innerHTML = "";

      if (!data || (Array.isArray(data) && data.length === 0)) {
        tableBody.innerHTML = `<tr><td colspan="4">No data found</td></tr>`;
        return;
      }

      const items = Array.isArray(data) ? data : [data];
      items.forEach(category => {
        const row = `<tr>
            <td>${category.id}</td>
            <td>${category.name}</td>
            <td>${category.categoryName}</td>
            <td>${category.dateOfBirth || 'N/A'}</td>
          </tr>`;
        tableBody.innerHTML += row;
      });
    }

    // Fetch all categories
    function fetchAll() {
      fetch(`${baseUrl}/all`)
        .then(res => res.json())
        .then(data => renderTable(data))
        .catch(err => console.error('Error fetching all:', err));
    }

    // Real-time search and category filter (with year support)
    function filterData() {
      const searchValue = searchInput.value.trim().toLowerCase();
      const category = categorySelect.value;

      fetch(`${baseUrl}/all`)
        .then(res => res.json())
        .then(data => {
          let filtered = data;

          // Filter by category
          if (category && category !== "all") {
            filtered = filtered.filter(c => c.categoryName === category);
          }

          // Filter by search input (ID, Name, or Year)
          if (searchValue) {
            filtered = filtered.filter(c => {
              const year = c.dateOfBirth ? new Date(c.dateOfBirth).getFullYear().toString() : "";
              return (
                c.name.toLowerCase().includes(searchValue) ||
                c.id.toString().includes(searchValue) ||
                year.includes(searchValue)
              );
            });
          }

          renderTable(filtered);
        })
        .catch(err => console.error('Error filtering data:', err));
    }

    // Attach events
    searchInput.addEventListener("input", filterData);
    categorySelect.addEventListener("change", filterData);

    // Load all initially
    window.onload = fetchAll;
</script>
</body>
</html>
